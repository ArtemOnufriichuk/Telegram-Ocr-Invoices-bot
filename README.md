# Telegram Ocr Invoices bot

Приложение для автоматического извлечения и структурирования данных из документов строительных проектов с помощью искусственного интеллекта.

## Возможности

- Анализ изображений квитанций и чеков через OCR
- Обработка PDF-документов
- Обработка Excel-таблиц с данными
- Извлечение данных о поставщиках, товарах и суммах
- Структурирование данных в формате JSON
- Интеграция с Telegram для удобной отправки и получения документов
- Умное распознавание различных форматов таблиц с помощью Claude
- Поддержка различных форматов документов и таблиц с адаптивным анализом

## Технологии

- Node.js & TypeScript
- Claude AI (Anthropic) для OCR и интеллектуального анализа документов
- Telegram Bot API
- XLSX для работы с Excel-файлами
- PDF Parser для обработки PDF-документов

## Установка

```bash
# Клонирование репозитория
git clone https://github.com/username/telegram-ocr-invoices-bot.git
cd telegram-ocr-invoices-bot

# Установка зависимостей
npm install

# Создайте файл .env в корне проекта со следующими переменными:
# TELEGRAM_BOT_TOKEN=ваш_токен_бота
# CLAUDE_API_KEY=ваш_ключ_api_claude
```

## Настройка

Перед запуском приложения необходимо создать файл `.env` в корне проекта со следующими переменными:

```
TELEGRAM_BOT_TOKEN=ваш_токен_бота
CLAUDE_API_KEY=ваш_ключ_api_claude
```

## Использование

```bash
# Запуск в режиме разработки
npm run dev

# Компиляция TypeScript
npm run build

# Запуск скомпилированного приложения
npm start
```

## Работа с Telegram ботом

Бот предлагает следующие команды:

- `/start` - Начать работу с ботом
- `/help` - Получить справку о командах

Просто отправьте боту документ или фото, и он автоматически извлечет все данные.

## Технология обработки документов

Бот использует продвинутый анализ на базе Claude для точного распознавания различных форматов таблиц. Особенно эффективен для:
- Документов с нестандартным форматированием
- Таблиц с разным расположением колонок и данных
- Счетов с уникальным дизайном
- Документов разных поставщиков

## Обработка документов

Приложение может обрабатывать следующие типы документов:

1. **Изображения** (jpg, jpeg, png) - извлекает текст с помощью OCR и анализирует его
2. **PDF файлы** - извлекает и анализирует текст из документов
3. **Excel-файлы** (xls, xlsx) - преобразует таблицы в структурированные данные

## Формат вывода

Результат обработки документа представляется в формате JSON со следующей структурой:

```json
{
	"invoice_number": "1234",                   // Номер счета
	"invoice_date": "01.01.2023",               // Дата счета
	"edrpou": "12345678",                       // ЕДРПОУ поставщика
	"ipn": "123456789012",                      // ИПН поставщика
	"supplier": "ООО Поставщик",                // Название поставщика
	"isPriceWithPdv": true,                     // Цены указаны с НДС/ПДВ
	"items": [                                  // Список товаров/услуг
		{
			"name": "Товар 1",                      // Название товара
			"article": "АРТ-001",                   // Артикул товара
			"quantity": 10,                         // Количество
			"unit": "шт",                           // Единица измерения
			"price_no_pdv": 100,                    // Цена без НДС
			"price_with_pdv": 120,                  // Цена с НДС
			"total_no_pdv": 1000,                   // Сумма без НДС
			"total_with_pdv": 1200                  // Сумма с НДС
		}
	],
	"total_no_pdv": 1000,                       // Общая сумма без НДС
	"total_pdv": 200,                           // Сумма НДС
	"total_with_pdv": 1200                      // Общая сумма с НДС
}
```

## Особенности реализации

- Модульная архитектура для лёгкого расширения функционала
- Эффективное извлечение текста из OCR-ответа с поддержкой текста и markdown
- Надёжная обработка ошибок и преобразование числовых значений
- Подробное логирование для отладки

## Telegram-бот

Для использования Telegram-бота необходимо:

1. Создать бота у @BotFather и получить токен
2. Указать токен в файле .env
3. Запустить приложение
4. Отправить боту фото квитанции, Excel-файл или текстовый файл

## Разработка

```bash
# Запуск в режиме разработки с отслеживанием изменений
npm run dev

# Запуск тестов
npm test
```

## Лицензия

MIT

## Контакты

Для вопросов и предложений свяжитесь с нами через [GitHub Issues](https://github.com/username/telegram-ocr-invoices-bot/issues).
